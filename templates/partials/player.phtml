<?php 
if (isset($player)) { 
?>
    <section class="player-profile">
        <div>
            <img src="<?= $player->getPortrait() ?>" alt="<?= $player->getNickname() ?>">
            <h2><?= $player->getNickname() ?></h2>
            
            <h3>
                <?php 
                $teamId = $player->getTeam();
                if (isset($data['teams'])) {
                    $teamFound = false;
                    foreach ($data['teams'] as $t) {
                        if ($t->getId() == $teamId) {
                            echo $t->getName();
                            $teamFound = true;
                            break;
                        }
                    }
                    if (!$teamFound) { echo "Team #" . $teamId; }
                } else {
                    echo "Team #" . $teamId;
                }
                ?>
            </h3>
        </div>

        <?php 
        require "templates/partials/player/_state.phtml"; 
        ?>

        <div>
            <a href="index.php?route=player">
                <button type="button">Retour à la liste</button>
            </a>
        </div>
    </section>

<?php 
} 

else { 
?>
    <section class="players">
        <?php 
        $teamsById = [];
        if (isset($data['teams'])) {
            foreach ($data['teams'] as $t) {
                $teamsById[$t->getId()] = $t;
            }
        }
        ?>

        <div class="contenue_player">
            <h2>LES PLAYERS DE LA LEAGUE</h2>
            
            <?php 
            if (isset($players) && !empty($players)) { 
            ?>
                <div class="vrap_teams"> 
                    <?php 
                    foreach ($players as $playerItem) { 
                    ?>
                        <div class="column_player">
                            <img src='<?= $playerItem->getPortrait() ?>' alt="Portrait">
                            <h3><?= $playerItem->getNickname() ?></h3>
                            
                            <h4>
                            <?php 
                            $teamId = $playerItem->getTeam();
                            if (isset($teamsById[$teamId])) {
                                echo $teamsById[$teamId]->getName(); 
                            } else {
                                echo "Team #" . $teamId;
                            }
                            ?>
                            </h4>
                            
                            <a href="index.php?route=player&id=<?= $playerItem->getId() ?>">
                                <button type="button">Découvrez <?= $playerItem->getNickname() ?></button>
                            </a>
                        </div>
                    <?php 
                    } 
                    ?>
                </div>
            <?php 
            } else { 
            ?>
                <p>Aucun joueur trouvé.</p>
            <?php 
            }
            ?>
        </div>
    </section>
<?php 
} 
?>